# TickTick MCP é¡¹ç›®æ”¹åŠ¨è®°å½•

## ğŸ”§ ä¿®å¤çš„é—®é¢˜

### 1. æ—¥æœŸæ ¼å¼éªŒè¯é—®é¢˜

**é—®é¢˜**ï¼šLLM é€šè¿‡ MCP åˆ›å»ºå¸¦æˆªæ­¢æ—¥æœŸçš„ä»»åŠ¡æ—¶å¤±è´¥

- é”™è¯¯ï¼š`Invalid due_date format. Use ISO format: YYYY-MM-DDThh:mm:ss+0000`
- åŸå› ï¼šPython `datetime.fromisoformat()` ä¸æ”¯æŒ `+0000` æ ¼å¼ï¼ˆæ— å†’å·ï¼‰

**ä¿®å¤**ï¼š

- æ·»åŠ  `normalize_iso_date()` å‡½æ•°åˆ° `server.py`
- æ›´æ–°ä¸‰å¤„æ—¥æœŸéªŒè¯ï¼š`create_task`ã€`update_task`ã€`_validate_task_data`
- æ”¯æŒæ‰€æœ‰æ—¥æœŸæ ¼å¼ï¼š`+0000`ã€`+00:00`ã€`Z`ã€`+0800`ã€`-0500` ç­‰

### 2. API å‚æ•°ä¸å®Œæ•´é—®é¢˜

**é—®é¢˜**ï¼šMCP å·¥å…·ç¼ºå°‘ TickTick å®˜æ–¹ API çš„å¤šä¸ªå‚æ•°

**ä¿®å¤**ï¼š

- `create_task` æ·»åŠ ï¼š`desc`ã€`is_all_day`ã€`time_zone`ã€`reminders`ã€`repeat_flag`ã€`sort_order`ã€`items`
- `update_task` æ·»åŠ ï¼š`desc`ã€`is_all_day`ã€`time_zone`ã€`reminders`ã€`repeat_flag`ã€`sort_order`ã€`items`
- `batch_create_tasks` æ”¯æŒæ‰€æœ‰æ–°å‚æ•°

### 3. ç¼ºå°‘ Inbox åŠŸèƒ½

**é—®é¢˜**ï¼šæ— æ³•è®¿é—® TickTick æ”¶ä»¶ç®±ä»»åŠ¡

**ä¿®å¤**ï¼š

- æ·»åŠ  `get_inbox_tasks()` MCP å·¥å…·
- ä½¿ç”¨ç‰¹æ®Šé¡¹ç›® ID `"inbox"` è®¿é—®æ”¶ä»¶ç®±
- æ›´æ–° `get_projects()` æ–‡æ¡£è¯´æ˜ Inbox éœ€è¦å•ç‹¬è·å–

### 4. æ—¶åŒºå¤„ç† Bug

**é—®é¢˜**ï¼š`get_tasks_due_today` å·¥å…·æ— æ³•æ­£ç¡®è¯†åˆ«ä»Šæ—¥åˆ°æœŸçš„ä»»åŠ¡

- ç—‡çŠ¶ï¼šæ˜æ˜æˆªæ­¢æ—¥æœŸæ˜¯ä»Šå¤©çš„ä»»åŠ¡ï¼ˆå¦‚"å†™æ–‡ç« "ä»»åŠ¡ï¼‰ï¼Œå´æ²¡æœ‰è¢«åˆ—ä¸º"ä»Šæ—¥åˆ°æœŸ"
- åŸå› ï¼šæ—¶åŒºæ¯”è¾ƒé€»è¾‘é”™è¯¯ - æ··ç”¨äº† UTC æ—¶åŒºå’Œç”¨æˆ·æ—¶åŒºçš„æ—¥æœŸè¿›è¡Œæ¯”è¾ƒ
- å…·ä½“ä¾‹å­ï¼š
  - ä»»åŠ¡ï¼š`2025-10-14 00:00:00 Asia/Shanghai` â†’ UTC: `2025-10-13T16:00:00+0000`
  - æ—§é€»è¾‘ï¼šæå– UTC æ—¥æœŸ `2025-10-13` vs ä»Šå¤© UTC æ—¥æœŸ `2025-10-14` â†’ âŒ ä¸åŒ¹é…
  - åº”è¯¥ï¼šéƒ½è½¬æ¢åˆ°ç”¨æˆ·æ—¶åŒºæ¯”è¾ƒ `2025-10-14` vs `2025-10-14` â†’ âœ… åŒ¹é…

**ä¿®å¤**ï¼š

- æ·»åŠ  `zoneinfo` æ¨¡å—å¯¼å…¥
- æ·»åŠ  `get_user_timezone_today()` è¾…åŠ©å‡½æ•° - ç»Ÿä¸€è·å–ç”¨æˆ·æ—¶åŒºçš„ä»Šå¤©æ—¥æœŸ
- ä¿®å¤ `_is_task_due_today()` - å°†ä»»åŠ¡æ—¶é—´è½¬æ¢åˆ°ç”¨æˆ·æ—¶åŒºåæ¯”è¾ƒæ—¥æœŸ
- ä¿®å¤ `_is_task_overdue()` - åœ¨ç”¨æˆ·æ—¶åŒºè¿›è¡Œè¿‡æœŸåˆ¤æ–­
- ä¿®å¤ `_is_task_due_in_days()` - åœ¨ç”¨æˆ·æ—¶åŒºè®¡ç®—æŒ‡å®šå¤©æ•°åçš„æ—¥æœŸ
- ä¿®å¤ `get_tasks_due_this_week()` ä¸­çš„ `week_filter` - åœ¨ç”¨æˆ·æ—¶åŒºåˆ¤æ–­æœ¬å‘¨èŒƒå›´

**ç¯å¢ƒå˜é‡**ï¼š

- è®¾ç½® `TICKTICK_DISPLAY_TIMEZONE="Asia/Shanghai"` å¯ç”¨æ—¶åŒºä¿®å¤

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### `ticktick_mcp/src/server.py`

- æ·»åŠ  `re` æ¨¡å—å¯¼å…¥
- æ·»åŠ  `zoneinfo` æ¨¡å—å¯¼å…¥ï¼ˆæ—¶åŒºä¿®å¤ï¼‰
- æ·»åŠ  `normalize_iso_date()` å‡½æ•°
- æ·»åŠ  `get_user_timezone_today()` è¾…åŠ©å‡½æ•°ï¼ˆæ—¶åŒºä¿®å¤ï¼‰
- æ›´æ–° `create_task()` å‚æ•°å’ŒéªŒè¯
- æ›´æ–° `update_task()` å‚æ•°å’ŒéªŒè¯
- æ›´æ–° `_validate_task_data()` éªŒè¯
- æ·»åŠ  `get_inbox_tasks()` å·¥å…·
- æ›´æ–° `get_projects()` æ–‡æ¡£
- ä¿®å¤ `_is_task_due_today()` æ—¶åŒºå¤„ç†
- ä¿®å¤ `_is_task_overdue()` æ—¶åŒºå¤„ç†
- ä¿®å¤ `_is_task_due_in_days()` æ—¶åŒºå¤„ç†
- ä¿®å¤ `get_tasks_due_this_week()` ä¸­çš„ `week_filter` æ—¶åŒºå¤„ç†

### `ticktick_mcp/src/ticktick_client.py`

- æ›´æ–° `create_task()` æ–¹æ³•å‚æ•°
- æ›´æ–° `update_task()` æ–¹æ³•å‚æ•°

## âœ… æµ‹è¯•ç»“æœ

- **å®Œæ•´ API æµ‹è¯•**ï¼š17/17 é€šè¿‡
- **æ—¥æœŸæ ¼å¼æµ‹è¯•**ï¼š9/9 é€šè¿‡
- **Inbox åŠŸèƒ½æµ‹è¯•**ï¼šæˆåŠŸè·å– 26 ä¸ªä»»åŠ¡
- **æ—¶åŒºä¿®å¤æµ‹è¯•**ï¼š3/3 é€šè¿‡
  - âœ… "å†™æ–‡ç« "ä»»åŠ¡æ­£ç¡®è¯†åˆ«ä¸ºä»Šæ—¥åˆ°æœŸï¼ˆä¿®å¤å‰ï¼šâŒ False â†’ ä¿®å¤åï¼šâœ… Trueï¼‰
  - âœ… "è£…æ°´"å’Œ"æŠŠ github ä¸»é¡µå¼„å¥½çœ‹"ä»»åŠ¡æ­£ç¡®è¯†åˆ«ä¸ºæ˜æ—¥åˆ°æœŸ
  - âœ… æ—¶åŒºè½¬æ¢é€»è¾‘éªŒè¯é€šè¿‡

## ğŸ¯ ä¿®å¤æ•ˆæœ

**ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œçš„åœºæ™¯**ï¼š

- LLM åˆ›å»ºå¸¦æˆªæ­¢æ—¥æœŸçš„ä»»åŠ¡ï¼ˆ`+0000` æ ¼å¼ï¼‰
- åˆ›å»ºå…¨å¤©ä»»åŠ¡ã€é‡å¤ä»»åŠ¡ã€å¸¦æé†’çš„ä»»åŠ¡
- è®¿é—®å’Œç®¡ç†æ”¶ä»¶ç®±ä»»åŠ¡
- æ‰¹é‡åˆ›å»ºä»»åŠ¡
- è®¾ç½®æ—¶åŒºå’Œå­ä»»åŠ¡
- æ­£ç¡®è¯†åˆ«ä»Šæ—¥åˆ°æœŸã€è¿‡æœŸã€æœªæ¥å‡ å¤©åˆ°æœŸçš„ä»»åŠ¡ï¼ˆæ—¶åŒºæ•æ„Ÿï¼‰

**å…³é”®ä¿®å¤**ï¼š

1. âœ… æ—¥æœŸæ ¼å¼é—®é¢˜å·²è§£å†³
2. âœ… API å‚æ•°å®Œå…¨å¯¹é½
3. âœ… Inbox åŠŸèƒ½å·²å®ç°
4. âœ… æ—¶åŒºå¤„ç† Bug å·²ä¿®å¤

## ğŸ—ï¸ é¡¹ç›®æ¶æ„è¯´æ˜

### ğŸ“¦ æ ¸å¿ƒç»„ä»¶

1. **MCP æœåŠ¡å™¨æ ¸å¿ƒ** (`server.py`)

   - FastMCP æœåŠ¡å™¨å®ç°
   - TickTick API å·¥å…·å°è£…
   - æ—¶åŒºå¤„ç†é€»è¾‘ âœ… **å·²ä¿®å¤**

2. **TickTick å®¢æˆ·ç«¯** (`ticktick_client.py`)

   - TickTick Open API å°è£…
   - HTTP è¯·æ±‚å¤„ç†
   - æ•°æ®æ ¼å¼è½¬æ¢

3. **è®¤è¯æ¨¡å—** (`authenticate.py`, `auth.py`)

   - OAuth 2.0 è®¤è¯æµç¨‹
   - Token ç®¡ç†
   - å‡­æ®éªŒè¯

4. **å‘½ä»¤è¡Œæ¥å£** (`cli.py`)
   - MCP æœåŠ¡å™¨å¯åŠ¨
   - é…ç½®ç®¡ç†
   - è°ƒè¯•å·¥å…·

### ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- ğŸ“‹ é¡¹ç›®å’Œä»»åŠ¡ç®¡ç†
- âœï¸ è‡ªç„¶è¯­è¨€åˆ›å»ºä»»åŠ¡
- ğŸ”„ ä»»åŠ¡çŠ¶æ€æ›´æ–°
- ğŸ“… æ—¶åŒºæ•æ„Ÿçš„æ—¥æœŸå¤„ç†
- ğŸ“¥ æ”¶ä»¶ç®±ä»»åŠ¡æ”¯æŒ
- ğŸ”Œ Claude MCP é›†æˆ

## ğŸ“š è¯¦ç»†åŠŸèƒ½æ–‡æ¡£

### ğŸ”§ æ—¶åŒºè½¬æ¢åŠŸèƒ½

TickTick MCP æ”¯æŒæ™ºèƒ½æ—¶åŒºè½¬æ¢ï¼Œå¯ä»¥å°† TickTick API è¿”å›çš„ UTC æ—¶é—´è‡ªåŠ¨è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´æˆ–æŒ‡å®šæ—¶åŒºçš„æ—¶é—´ã€‚

#### ä¸»è¦ç‰¹æ€§

1. **è‡ªåŠ¨æ—¶åŒºè½¬æ¢**

   - **é»˜è®¤è¡Œä¸º**ï¼šæ‰€æœ‰ä»»åŠ¡çš„æ—¥æœŸæ—¶é—´ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæœ¬åœ°æ—¶åŒºæ˜¾ç¤º
   - **æ™ºèƒ½ä¼˜å…ˆçº§**ï¼šä»»åŠ¡æ—¶åŒº > é…ç½®æ—¶åŒº > ç³»ç»Ÿæœ¬åœ°æ—¶åŒº
   - **å‘åå…¼å®¹**ï¼šä¿æŒåŸå§‹ UTC æ—¶é—´ä¿¡æ¯ä»¥ä¾›å‚è€ƒ

2. **æ˜¾ç¤ºæ ¼å¼**

   ```
   2024-01-20 17:00:00 (Asia/Shanghai) [UTC: 2024-01-20T09:00:00+0000]
   ```

   åŒ…å«ï¼š

   - æœ¬åœ°æ—¶é—´ï¼š`2024-01-20 17:00:00`
   - æ—¶åŒºæ ‡è¯†ï¼š`(Asia/Shanghai)`
   - åŸå§‹ UTC æ—¶é—´ï¼š`[UTC: 2024-01-20T09:00:00+0000]`

3. **ç¯å¢ƒå˜é‡é…ç½®**
   ```bash
   # åœ¨ .env æ–‡ä»¶ä¸­æ·»åŠ 
   TICKTICK_DISPLAY_TIMEZONE=Asia/Shanghai
   ```

#### æ”¯æŒçš„æ—¶åŒº

- `Local` - ä½¿ç”¨ç³»ç»Ÿæœ¬åœ°æ—¶åŒºï¼ˆé»˜è®¤ï¼‰
- `Asia/Shanghai` - ä¸­å›½æ ‡å‡†æ—¶é—´
- `America/New_York` - ç¾å›½ä¸œéƒ¨æ—¶é—´
- `Europe/London` - è‹±å›½æ—¶é—´
- `Asia/Tokyo` - æ—¥æœ¬æ ‡å‡†æ—¶é—´
- ç­‰ç­‰...ï¼ˆæ”¯æŒæ‰€æœ‰ IANA æ—¶åŒºæ ‡è¯†ç¬¦ï¼‰

#### æŠ€æœ¯å®ç°

- `convert_utc_to_local()` - UTC æ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´
- `normalize_iso_date()` - æ ‡å‡†åŒ– ISO æ—¥æœŸæ ¼å¼
- `format_task()` - æ ¼å¼åŒ–ä»»åŠ¡æ˜¾ç¤ºï¼ˆæ”¯æŒæ—¶åŒºè½¬æ¢ï¼‰

### ğŸ“¥ Inbox åŠŸèƒ½è¯¦è§£

#### æ ¸å¿ƒå‘ç°

1. **Inbox æ˜¯ç‰¹æ®Šé¡¹ç›®**

   - å›ºå®šçš„é¡¹ç›® IDï¼š`"inbox"`ï¼ˆå°å†™ï¼‰
   - ä¸åœ¨æ™®é€šé¡¹ç›®åˆ—è¡¨ API ä¸­è¿”å›
   - ä½†å¯ä»¥é€šè¿‡ `GET /open/v1/project/inbox/data` è®¿é—®

2. **API è¡Œä¸º**
   - å¯ä»¥è¯»å–ï¼šâœ…
   - å¯ä»¥åˆ›å»ºä»»åŠ¡ï¼šâœ…
   - å¯ä»¥åˆ é™¤ä»»åŠ¡ï¼šâœ…
   - ä¸æ™®é€šé¡¹ç›® API ä¸€è‡´

#### ä½¿ç”¨åœºæ™¯

1. **å¿«é€ŸæŸ¥çœ‹æ”¶ä»¶ç®±**

   ```
   ç”¨æˆ·: "æˆ‘æ”¶ä»¶ç®±é‡Œæœ‰ä»€ä¹ˆï¼Ÿ"
   LLM: è°ƒç”¨ get_inbox_tasks()
   è¿”å›: 26 ä¸ªä»»åŠ¡çš„è¯¦ç»†åˆ—è¡¨
   ```

2. **å¿«é€Ÿè®°å½•æƒ³æ³•**

   ```
   ç”¨æˆ·: "è®°ä¸€ä¸ªä»»åŠ¡ï¼šä¹°ç‰›å¥¶"
   LLM: create_task(title="ä¹°ç‰›å¥¶", project_id="inbox")
   ç»“æœ: ä»»åŠ¡å¿«é€Ÿä¿å­˜åˆ°æ”¶ä»¶ç®±
   ```

3. **æ•´ç†ä»»åŠ¡**
   ```
   ç”¨æˆ·: "æ˜¾ç¤ºæˆ‘çš„æ”¶ä»¶ç®±ä»»åŠ¡"
   LLM: get_inbox_tasks()
   ç”¨æˆ·: "æŠŠç¬¬ä¸€ä¸ªä»»åŠ¡ç§»åˆ°å·¥ä½œé¡¹ç›®"
   LLM: update_task(..., project_id="å·¥ä½œé¡¹ç›®ID")
   ```

#### ä»£ç ç¤ºä¾‹

```python
# åœ¨ MCP å·¥å…·ä¸­
@mcp.tool()
async def get_inbox_tasks() -> str:
    """è·å–æ”¶ä»¶ç®±ä»»åŠ¡"""
    inbox_data = ticktick.get_project_with_data("inbox")

    if 'error' in inbox_data:
        return f"Error: {inbox_data['error']}"

    tasks = inbox_data.get('tasks', [])

    if not tasks:
        return "Your inbox is empty. ğŸ“­"

    return format_tasks(tasks)
```

---

_è®°å½•æ—¥æœŸï¼š2025-10-11ï¼ˆåˆå§‹ä¿®å¤ï¼‰_  
_æ—¶åŒºä¿®å¤æ—¥æœŸï¼š2025-10-14_
